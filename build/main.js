/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/


// src/main.js
var { Plugin, TFile, Notice } = require("obsidian");
var { spawn } = require("child_process");
var path = require("path");
var fs = require("fs");
module.exports = class ObsidianSqliteSync extends Plugin {
  async onload() {
    console.log("loading ObsidianSqliteSync plugin");
    const startTime = performance.now();
    try {
      await this.initializeDatabase();
      this.registerEvent(
        this.app.vault.on("modify", this.handleFileModify.bind(this))
      );
      this.registerEvent(
        this.app.vault.on("create", this.handleFileCreate.bind(this))
      );
      this.registerEvent(
        this.app.vault.on("delete", this.handleFileDelete.bind(this))
      );
      this.registerEvent(
        this.app.vault.on("rename", this.handleFileRename.bind(this))
      );
      this.registerEvent(
        this.app.metadataCache.on(
          "changed",
          this.handleMetadataChange.bind(this)
        )
      );
      this.registerEvent(
        this.app.workspace.on("file-open", this.handleFileOpen.bind(this))
      );
      await this.fullSync();
      this.registerInterval(
        window.setInterval(() => this.fullSync(), 60 * 60 * 1e3)
        // Every hour
      );
      const endTime = performance.now();
      const totalTime = endTime - startTime;
      const formattedTime = totalTime >= 1e3 ? `${(totalTime / 1e3).toFixed(2)} seconds` : `${Math.round(totalTime)} milliseconds`;
      new Notice(`Alfred database initialized in ${formattedTime}`);
    } catch (error) {
      console.error("Failed to initialize sqlite3:", error);
      new Notice(
        "Failed to initialize Alfred database. Check console for details.",
        5e3
      );
    }
  }
  onunload() {
    console.log("unloading ObsidianSqliteSync plugin");
    if (this.db) {
      this.db.stdin.end();
    }
  }
  async initializeDatabase() {
    const dbPath = path.join(
      app.vault.adapter.basePath,
      ".obsidian",
      "plugins",
      this.manifest.id,
      "alfred_sync.db"
    );
    if (fs.existsSync(dbPath)) {
      fs.unlinkSync(dbPath);
    }
    this.db = spawn("sqlite3", [dbPath]);
    this.db.stdout.on("data", (data) => {
      console.log(`sqlite3 stdout: ${data}`);
    });
    this.db.stderr.on("data", (data) => {
      console.error(`sqlite3 stderr: ${data}`);
    });
    this.db.on("close", (code) => {
      console.log(`sqlite3 process exited with code ${code}`);
    });
    const createTablesSQL = `
      CREATE TABLE IF NOT EXISTS note (
        path TEXT PRIMARY KEY,
        title TEXT,
        content TEXT,
        created INTEGER,
        last_modified INTEGER,
        last_opened INTEGER
      );

      CREATE TABLE IF NOT EXISTS tag (
        name TEXT PRIMARY KEY
      );

      CREATE TABLE IF NOT EXISTS note_tag (
        note_path TEXT,
        tag_name TEXT,
        PRIMARY KEY (note_path, tag_name),
        FOREIGN KEY (note_path) REFERENCES note(path) ON DELETE CASCADE,
        FOREIGN KEY (tag_name) REFERENCES tag(name) ON DELETE CASCADE
      );

      CREATE TABLE IF NOT EXISTS note_frontmatter (
        note_path TEXT,
        frontmatter_name TEXT,
        frontmatter_value TEXT,
        PRIMARY KEY (note_path, frontmatter_name),
        FOREIGN KEY (note_path) REFERENCES note(path) ON DELETE CASCADE
      );
    `;
    await this.executeSQL(createTablesSQL);
  }
  executeSQL(sql) {
    return new Promise((resolve, reject) => {
      this.db.stdin.write(sql + ";\n");
      this.db.stdin.write('.print "QUERY_COMPLETE"\n');
      let output = "";
      const dataHandler = (data) => {
        output += data.toString();
        if (output.includes("QUERY_COMPLETE")) {
          this.db.stdout.removeListener("data", dataHandler);
          resolve(output.replace("QUERY_COMPLETE", "").trim());
        }
      };
      this.db.stdout.on("data", dataHandler);
    });
  }
  async handleFileModify(file) {
    if (file instanceof TFile && file.extension === "md") {
      console.log("File modified:", file.path);
      const fileInfo = await this.getFileInfo(file);
      await this.updateDatabase(fileInfo);
    }
  }
  async handleFileCreate(file) {
    if (file instanceof TFile && file.extension === "md") {
      console.log("File created:", file.path);
      const fileInfo = await this.getFileInfo(file);
      await this.insertIntoDatabase(fileInfo);
    }
  }
  async handleFileDelete(file) {
    if (file instanceof TFile && file.extension === "md") {
      console.log("File deleted:", file.path);
      await this.deleteFromDatabase(file.path);
    }
  }
  async handleFileRename(file, oldPath) {
    if (file instanceof TFile && file.extension === "md") {
      console.log("File renamed from", oldPath, "to", file.path);
      await this.deleteFromDatabase(oldPath);
      const fileInfo = await this.getFileInfo(file);
      await this.insertIntoDatabase(fileInfo);
    }
  }
  async handleMetadataChange(file) {
    if (file instanceof TFile && file.extension === "md") {
      console.log("Metadata changed for file:", file.path);
      const fileInfo = await this.getFileInfo(file);
      await this.updateDatabase(fileInfo);
    }
  }
  async handleFileOpen(file) {
    if (file instanceof TFile && file.extension === "md") {
      console.log("File opened:", file.path);
      const updateLastOpenedSQL = `
        UPDATE note
        SET last_opened = ${Date.now()}
        WHERE path = '${this.escapeSQLString(file.path)}'
      `;
      await this.executeSQL(updateLastOpenedSQL);
    }
  }
  async getFileInfo(file) {
    var _a;
    const cache = this.app.metadataCache.getFileCache(file);
    const frontmatter = (cache == null ? void 0 : cache.frontmatter) || {};
    const content = await this.app.vault.read(file);
    const cleanedContent = this.removeMetadataAndTags(
      content,
      frontmatter,
      cache == null ? void 0 : cache.tags
    );
    return {
      path: file.path,
      title: frontmatter.title || file.basename,
      content: cleanedContent,
      tags: ((_a = cache == null ? void 0 : cache.tags) == null ? void 0 : _a.map((tag) => tag.tag)) || [],
      frontmatter,
      created: file.stat.ctime,
      last_modified: file.stat.mtime
    };
  }
  removeMetadataAndTags(content, frontmatter, tags) {
    let cleanedContent = content.replace(/^---\n[\s\S]*?\n---\n/, "");
    if (tags) {
      tags.forEach((tag) => {
        const tagRegex = new RegExp(`#${tag.tag}\\b`, "g");
        cleanedContent = cleanedContent.replace(tagRegex, "");
      });
    }
    return cleanedContent.trim();
  }
  async updateDatabase(fileInfo) {
    const updateNoteSQL = `
      INSERT OR REPLACE INTO note (path, title, content, created, last_modified, last_opened)
      VALUES (
        '${this.escapeSQLString(fileInfo.path)}',
        '${this.escapeSQLString(fileInfo.title)}',
        '${this.escapeSQLString(fileInfo.content)}',
        ${fileInfo.created},
        ${fileInfo.last_modified},
        COALESCE((SELECT last_opened FROM note WHERE path = '${this.escapeSQLString(
      fileInfo.path
    )}'), ${Date.now()})
      )
    `;
    await this.executeSQL(updateNoteSQL);
    await this.updateNoteTags(fileInfo.path, fileInfo.tags);
    await this.updateNoteFrontmatter(fileInfo.path, fileInfo.frontmatter);
  }
  async insertIntoDatabase(fileInfo) {
    await this.updateDatabase(fileInfo);
  }
  async deleteFromDatabase(path2) {
    const deleteNoteSQL = `DELETE FROM note WHERE path = '${this.escapeSQLString(
      path2
    )}'`;
    await this.executeSQL(deleteNoteSQL);
  }
  async updateNoteTags(notePath, tags) {
    const deleteNoteTagsSQL = `DELETE FROM note_tag WHERE note_path = '${this.escapeSQLString(
      notePath
    )}'`;
    await this.executeSQL(deleteNoteTagsSQL);
    for (const tag of tags) {
      const insertTagSQL = `
        INSERT OR IGNORE INTO tag (name) VALUES ('${this.escapeSQLString(tag)}')
      `;
      await this.executeSQL(insertTagSQL);
      const insertNoteTagSQL = `
        INSERT INTO note_tag (note_path, tag_name) 
        VALUES ('${this.escapeSQLString(notePath)}', '${this.escapeSQLString(
        tag
      )}')
      `;
      await this.executeSQL(insertNoteTagSQL);
    }
  }
  async updateNoteFrontmatter(notePath, frontmatter) {
    const deleteNoteFrontmatterSQL = `DELETE FROM note_frontmatter WHERE note_path = '${this.escapeSQLString(
      notePath
    )}'`;
    await this.executeSQL(deleteNoteFrontmatterSQL);
    for (const [key, value] of Object.entries(frontmatter)) {
      const stringifiedValue = JSON.stringify(value);
      const insertNoteFrontmatterSQL = `
        INSERT INTO note_frontmatter (note_path, frontmatter_name, frontmatter_value) 
        VALUES ('${this.escapeSQLString(notePath)}', '${this.escapeSQLString(
        key
      )}', '${this.escapeSQLString(stringifiedValue)}')
      `;
      await this.executeSQL(insertNoteFrontmatterSQL);
    }
  }
  async syncTags() {
    const allTags = this.app.metadataCache.getTags();
    for (const tag of Object.keys(allTags)) {
      const insertTagSQL = `
        INSERT OR IGNORE INTO tag (name) VALUES ('${this.escapeSQLString(
        tag.slice(1)
      )}')
      `;
      await this.executeSQL(insertTagSQL);
    }
    const removeUnusedTagsSQL = `
      DELETE FROM tag 
      WHERE name NOT IN (SELECT DISTINCT tag_name FROM note_tag)
    `;
    await this.executeSQL(removeUnusedTagsSQL);
  }
  async fullSync() {
    console.log("Performing full sync");
    const files = this.app.vault.getMarkdownFiles();
    for (const file of files) {
      const fileInfo = await this.getFileInfo(file);
      await this.insertIntoDatabase(fileInfo);
    }
    await this.syncTags();
    console.log("Full sync completed");
  }
  escapeSQLString(str) {
    return str.replace(/'/g, "''");
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vc3JjL21haW4uanMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbImNvbnN0IHsgUGx1Z2luLCBURmlsZSwgTm90aWNlIH0gPSByZXF1aXJlKCdvYnNpZGlhbicpO1xuY29uc3QgeyBzcGF3biB9ID0gcmVxdWlyZSgnY2hpbGRfcHJvY2VzcycpO1xuY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcbmNvbnN0IGZzID0gcmVxdWlyZSgnZnMnKTtcblxubW9kdWxlLmV4cG9ydHMgPSBjbGFzcyBPYnNpZGlhblNxbGl0ZVN5bmMgZXh0ZW5kcyBQbHVnaW4ge1xuICBhc3luYyBvbmxvYWQoKSB7XG4gICAgY29uc29sZS5sb2coJ2xvYWRpbmcgT2JzaWRpYW5TcWxpdGVTeW5jIHBsdWdpbicpO1xuXG4gICAgY29uc3Qgc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG5cbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5pbml0aWFsaXplRGF0YWJhc2UoKTtcblxuICAgICAgdGhpcy5yZWdpc3RlckV2ZW50KFxuICAgICAgICB0aGlzLmFwcC52YXVsdC5vbignbW9kaWZ5JywgdGhpcy5oYW5kbGVGaWxlTW9kaWZ5LmJpbmQodGhpcykpXG4gICAgICApO1xuXG4gICAgICB0aGlzLnJlZ2lzdGVyRXZlbnQoXG4gICAgICAgIHRoaXMuYXBwLnZhdWx0Lm9uKCdjcmVhdGUnLCB0aGlzLmhhbmRsZUZpbGVDcmVhdGUuYmluZCh0aGlzKSlcbiAgICAgICk7XG5cbiAgICAgIHRoaXMucmVnaXN0ZXJFdmVudChcbiAgICAgICAgdGhpcy5hcHAudmF1bHQub24oJ2RlbGV0ZScsIHRoaXMuaGFuZGxlRmlsZURlbGV0ZS5iaW5kKHRoaXMpKVxuICAgICAgKTtcblxuICAgICAgdGhpcy5yZWdpc3RlckV2ZW50KFxuICAgICAgICB0aGlzLmFwcC52YXVsdC5vbigncmVuYW1lJywgdGhpcy5oYW5kbGVGaWxlUmVuYW1lLmJpbmQodGhpcykpXG4gICAgICApO1xuXG4gICAgICAvLyBSZWdpc3RlciBldmVudCBmb3IgbWV0YWRhdGEgY2hhbmdlc1xuICAgICAgdGhpcy5yZWdpc3RlckV2ZW50KFxuICAgICAgICB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLm9uKFxuICAgICAgICAgICdjaGFuZ2VkJyxcbiAgICAgICAgICB0aGlzLmhhbmRsZU1ldGFkYXRhQ2hhbmdlLmJpbmQodGhpcylcbiAgICAgICAgKVxuICAgICAgKTtcblxuICAgICAgLy8gUmVnaXN0ZXIgZXZlbnQgZm9yIGZpbGUgb3BlblxuICAgICAgdGhpcy5yZWdpc3RlckV2ZW50KFxuICAgICAgICB0aGlzLmFwcC53b3Jrc3BhY2Uub24oJ2ZpbGUtb3BlbicsIHRoaXMuaGFuZGxlRmlsZU9wZW4uYmluZCh0aGlzKSlcbiAgICAgICk7XG5cbiAgICAgIC8vIFBlcmZvcm0gYSBmdWxsIHN5bmMgb24gbG9hZFxuICAgICAgYXdhaXQgdGhpcy5mdWxsU3luYygpO1xuXG4gICAgICAvLyBTY2hlZHVsZSBwZXJpb2RpYyBmdWxsIHN5bmNzXG4gICAgICB0aGlzLnJlZ2lzdGVySW50ZXJ2YWwoXG4gICAgICAgIHdpbmRvdy5zZXRJbnRlcnZhbCgoKSA9PiB0aGlzLmZ1bGxTeW5jKCksIDYwICogNjAgKiAxMDAwKSAvLyBFdmVyeSBob3VyXG4gICAgICApO1xuXG4gICAgICBjb25zdCBlbmRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICBjb25zdCB0b3RhbFRpbWUgPSBlbmRUaW1lIC0gc3RhcnRUaW1lO1xuICAgICAgY29uc3QgZm9ybWF0dGVkVGltZSA9XG4gICAgICAgIHRvdGFsVGltZSA+PSAxMDAwXG4gICAgICAgICAgPyBgJHsodG90YWxUaW1lIC8gMTAwMCkudG9GaXhlZCgyKX0gc2Vjb25kc2BcbiAgICAgICAgICA6IGAke01hdGgucm91bmQodG90YWxUaW1lKX0gbWlsbGlzZWNvbmRzYDtcblxuICAgICAgbmV3IE5vdGljZShgQWxmcmVkIGRhdGFiYXNlIGluaXRpYWxpemVkIGluICR7Zm9ybWF0dGVkVGltZX1gKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGluaXRpYWxpemUgc3FsaXRlMzonLCBlcnJvcik7XG4gICAgICBuZXcgTm90aWNlKFxuICAgICAgICAnRmFpbGVkIHRvIGluaXRpYWxpemUgQWxmcmVkIGRhdGFiYXNlLiBDaGVjayBjb25zb2xlIGZvciBkZXRhaWxzLicsXG4gICAgICAgIDUwMDBcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgb251bmxvYWQoKSB7XG4gICAgY29uc29sZS5sb2coJ3VubG9hZGluZyBPYnNpZGlhblNxbGl0ZVN5bmMgcGx1Z2luJyk7XG4gICAgaWYgKHRoaXMuZGIpIHtcbiAgICAgIHRoaXMuZGIuc3RkaW4uZW5kKCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgaW5pdGlhbGl6ZURhdGFiYXNlKCkge1xuICAgIGNvbnN0IGRiUGF0aCA9IHBhdGguam9pbihcbiAgICAgIGFwcC52YXVsdC5hZGFwdGVyLmJhc2VQYXRoLFxuICAgICAgJy5vYnNpZGlhbicsXG4gICAgICAncGx1Z2lucycsXG4gICAgICB0aGlzLm1hbmlmZXN0LmlkLFxuICAgICAgJ2FsZnJlZF9zeW5jLmRiJ1xuICAgICk7XG5cbiAgICAvLyBEcm9wIHRoZSBleGlzdGluZyBkYXRhYmFzZVxuICAgIGlmIChmcy5leGlzdHNTeW5jKGRiUGF0aCkpIHtcbiAgICAgIGZzLnVubGlua1N5bmMoZGJQYXRoKTtcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgYSBuZXcgZGF0YWJhc2VcbiAgICB0aGlzLmRiID0gc3Bhd24oJ3NxbGl0ZTMnLCBbZGJQYXRoXSk7XG4gICAgdGhpcy5kYi5zdGRvdXQub24oJ2RhdGEnLCAoZGF0YSkgPT4ge1xuICAgICAgY29uc29sZS5sb2coYHNxbGl0ZTMgc3Rkb3V0OiAke2RhdGF9YCk7XG4gICAgfSk7XG4gICAgdGhpcy5kYi5zdGRlcnIub24oJ2RhdGEnLCAoZGF0YSkgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcihgc3FsaXRlMyBzdGRlcnI6ICR7ZGF0YX1gKTtcbiAgICB9KTtcbiAgICB0aGlzLmRiLm9uKCdjbG9zZScsIChjb2RlKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhgc3FsaXRlMyBwcm9jZXNzIGV4aXRlZCB3aXRoIGNvZGUgJHtjb2RlfWApO1xuICAgIH0pO1xuXG4gICAgY29uc3QgY3JlYXRlVGFibGVzU1FMID0gYFxuICAgICAgQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgbm90ZSAoXG4gICAgICAgIHBhdGggVEVYVCBQUklNQVJZIEtFWSxcbiAgICAgICAgdGl0bGUgVEVYVCxcbiAgICAgICAgY29udGVudCBURVhULFxuICAgICAgICBjcmVhdGVkIElOVEVHRVIsXG4gICAgICAgIGxhc3RfbW9kaWZpZWQgSU5URUdFUixcbiAgICAgICAgbGFzdF9vcGVuZWQgSU5URUdFUlxuICAgICAgKTtcblxuICAgICAgQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgdGFnIChcbiAgICAgICAgbmFtZSBURVhUIFBSSU1BUlkgS0VZXG4gICAgICApO1xuXG4gICAgICBDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyBub3RlX3RhZyAoXG4gICAgICAgIG5vdGVfcGF0aCBURVhULFxuICAgICAgICB0YWdfbmFtZSBURVhULFxuICAgICAgICBQUklNQVJZIEtFWSAobm90ZV9wYXRoLCB0YWdfbmFtZSksXG4gICAgICAgIEZPUkVJR04gS0VZIChub3RlX3BhdGgpIFJFRkVSRU5DRVMgbm90ZShwYXRoKSBPTiBERUxFVEUgQ0FTQ0FERSxcbiAgICAgICAgRk9SRUlHTiBLRVkgKHRhZ19uYW1lKSBSRUZFUkVOQ0VTIHRhZyhuYW1lKSBPTiBERUxFVEUgQ0FTQ0FERVxuICAgICAgKTtcblxuICAgICAgQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgbm90ZV9mcm9udG1hdHRlciAoXG4gICAgICAgIG5vdGVfcGF0aCBURVhULFxuICAgICAgICBmcm9udG1hdHRlcl9uYW1lIFRFWFQsXG4gICAgICAgIGZyb250bWF0dGVyX3ZhbHVlIFRFWFQsXG4gICAgICAgIFBSSU1BUlkgS0VZIChub3RlX3BhdGgsIGZyb250bWF0dGVyX25hbWUpLFxuICAgICAgICBGT1JFSUdOIEtFWSAobm90ZV9wYXRoKSBSRUZFUkVOQ0VTIG5vdGUocGF0aCkgT04gREVMRVRFIENBU0NBREVcbiAgICAgICk7XG4gICAgYDtcbiAgICBhd2FpdCB0aGlzLmV4ZWN1dGVTUUwoY3JlYXRlVGFibGVzU1FMKTtcbiAgfVxuXG4gIGV4ZWN1dGVTUUwoc3FsKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHRoaXMuZGIuc3RkaW4ud3JpdGUoc3FsICsgJztcXG4nKTtcbiAgICAgIHRoaXMuZGIuc3RkaW4ud3JpdGUoJy5wcmludCBcIlFVRVJZX0NPTVBMRVRFXCJcXG4nKTtcblxuICAgICAgbGV0IG91dHB1dCA9ICcnO1xuICAgICAgY29uc3QgZGF0YUhhbmRsZXIgPSAoZGF0YSkgPT4ge1xuICAgICAgICBvdXRwdXQgKz0gZGF0YS50b1N0cmluZygpO1xuICAgICAgICBpZiAob3V0cHV0LmluY2x1ZGVzKCdRVUVSWV9DT01QTEVURScpKSB7XG4gICAgICAgICAgdGhpcy5kYi5zdGRvdXQucmVtb3ZlTGlzdGVuZXIoJ2RhdGEnLCBkYXRhSGFuZGxlcik7XG4gICAgICAgICAgcmVzb2x2ZShvdXRwdXQucmVwbGFjZSgnUVVFUllfQ09NUExFVEUnLCAnJykudHJpbSgpKTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgdGhpcy5kYi5zdGRvdXQub24oJ2RhdGEnLCBkYXRhSGFuZGxlcik7XG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBoYW5kbGVGaWxlTW9kaWZ5KGZpbGUpIHtcbiAgICBpZiAoZmlsZSBpbnN0YW5jZW9mIFRGaWxlICYmIGZpbGUuZXh0ZW5zaW9uID09PSAnbWQnKSB7XG4gICAgICBjb25zb2xlLmxvZygnRmlsZSBtb2RpZmllZDonLCBmaWxlLnBhdGgpO1xuICAgICAgY29uc3QgZmlsZUluZm8gPSBhd2FpdCB0aGlzLmdldEZpbGVJbmZvKGZpbGUpO1xuICAgICAgYXdhaXQgdGhpcy51cGRhdGVEYXRhYmFzZShmaWxlSW5mbyk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgaGFuZGxlRmlsZUNyZWF0ZShmaWxlKSB7XG4gICAgaWYgKGZpbGUgaW5zdGFuY2VvZiBURmlsZSAmJiBmaWxlLmV4dGVuc2lvbiA9PT0gJ21kJykge1xuICAgICAgY29uc29sZS5sb2coJ0ZpbGUgY3JlYXRlZDonLCBmaWxlLnBhdGgpO1xuICAgICAgY29uc3QgZmlsZUluZm8gPSBhd2FpdCB0aGlzLmdldEZpbGVJbmZvKGZpbGUpO1xuICAgICAgYXdhaXQgdGhpcy5pbnNlcnRJbnRvRGF0YWJhc2UoZmlsZUluZm8pO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGhhbmRsZUZpbGVEZWxldGUoZmlsZSkge1xuICAgIGlmIChmaWxlIGluc3RhbmNlb2YgVEZpbGUgJiYgZmlsZS5leHRlbnNpb24gPT09ICdtZCcpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdGaWxlIGRlbGV0ZWQ6JywgZmlsZS5wYXRoKTtcbiAgICAgIGF3YWl0IHRoaXMuZGVsZXRlRnJvbURhdGFiYXNlKGZpbGUucGF0aCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgaGFuZGxlRmlsZVJlbmFtZShmaWxlLCBvbGRQYXRoKSB7XG4gICAgaWYgKGZpbGUgaW5zdGFuY2VvZiBURmlsZSAmJiBmaWxlLmV4dGVuc2lvbiA9PT0gJ21kJykge1xuICAgICAgY29uc29sZS5sb2coJ0ZpbGUgcmVuYW1lZCBmcm9tJywgb2xkUGF0aCwgJ3RvJywgZmlsZS5wYXRoKTtcbiAgICAgIGF3YWl0IHRoaXMuZGVsZXRlRnJvbURhdGFiYXNlKG9sZFBhdGgpO1xuICAgICAgY29uc3QgZmlsZUluZm8gPSBhd2FpdCB0aGlzLmdldEZpbGVJbmZvKGZpbGUpO1xuICAgICAgYXdhaXQgdGhpcy5pbnNlcnRJbnRvRGF0YWJhc2UoZmlsZUluZm8pO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGhhbmRsZU1ldGFkYXRhQ2hhbmdlKGZpbGUpIHtcbiAgICBpZiAoZmlsZSBpbnN0YW5jZW9mIFRGaWxlICYmIGZpbGUuZXh0ZW5zaW9uID09PSAnbWQnKSB7XG4gICAgICBjb25zb2xlLmxvZygnTWV0YWRhdGEgY2hhbmdlZCBmb3IgZmlsZTonLCBmaWxlLnBhdGgpO1xuICAgICAgY29uc3QgZmlsZUluZm8gPSBhd2FpdCB0aGlzLmdldEZpbGVJbmZvKGZpbGUpO1xuICAgICAgYXdhaXQgdGhpcy51cGRhdGVEYXRhYmFzZShmaWxlSW5mbyk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgaGFuZGxlRmlsZU9wZW4oZmlsZSkge1xuICAgIGlmIChmaWxlIGluc3RhbmNlb2YgVEZpbGUgJiYgZmlsZS5leHRlbnNpb24gPT09ICdtZCcpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdGaWxlIG9wZW5lZDonLCBmaWxlLnBhdGgpO1xuICAgICAgY29uc3QgdXBkYXRlTGFzdE9wZW5lZFNRTCA9IGBcbiAgICAgICAgVVBEQVRFIG5vdGVcbiAgICAgICAgU0VUIGxhc3Rfb3BlbmVkID0gJHtEYXRlLm5vdygpfVxuICAgICAgICBXSEVSRSBwYXRoID0gJyR7dGhpcy5lc2NhcGVTUUxTdHJpbmcoZmlsZS5wYXRoKX0nXG4gICAgICBgO1xuICAgICAgYXdhaXQgdGhpcy5leGVjdXRlU1FMKHVwZGF0ZUxhc3RPcGVuZWRTUUwpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGdldEZpbGVJbmZvKGZpbGUpIHtcbiAgICBjb25zdCBjYWNoZSA9IHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0RmlsZUNhY2hlKGZpbGUpO1xuICAgIGNvbnN0IGZyb250bWF0dGVyID0gY2FjaGU/LmZyb250bWF0dGVyIHx8IHt9O1xuICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKGZpbGUpO1xuXG4gICAgY29uc3QgY2xlYW5lZENvbnRlbnQgPSB0aGlzLnJlbW92ZU1ldGFkYXRhQW5kVGFncyhcbiAgICAgIGNvbnRlbnQsXG4gICAgICBmcm9udG1hdHRlcixcbiAgICAgIGNhY2hlPy50YWdzXG4gICAgKTtcblxuICAgIHJldHVybiB7XG4gICAgICBwYXRoOiBmaWxlLnBhdGgsXG4gICAgICB0aXRsZTogZnJvbnRtYXR0ZXIudGl0bGUgfHwgZmlsZS5iYXNlbmFtZSxcbiAgICAgIGNvbnRlbnQ6IGNsZWFuZWRDb250ZW50LFxuICAgICAgdGFnczogY2FjaGU/LnRhZ3M/Lm1hcCgodGFnKSA9PiB0YWcudGFnKSB8fCBbXSxcbiAgICAgIGZyb250bWF0dGVyOiBmcm9udG1hdHRlcixcbiAgICAgIGNyZWF0ZWQ6IGZpbGUuc3RhdC5jdGltZSxcbiAgICAgIGxhc3RfbW9kaWZpZWQ6IGZpbGUuc3RhdC5tdGltZSxcbiAgICB9O1xuICB9XG5cbiAgcmVtb3ZlTWV0YWRhdGFBbmRUYWdzKGNvbnRlbnQsIGZyb250bWF0dGVyLCB0YWdzKSB7XG4gICAgLy8gUmVtb3ZlIGZyb250bWF0dGVyXG4gICAgbGV0IGNsZWFuZWRDb250ZW50ID0gY29udGVudC5yZXBsYWNlKC9eLS0tXFxuW1xcc1xcU10qP1xcbi0tLVxcbi8sICcnKTtcblxuICAgIC8vIFJlbW92ZSB0YWdzXG4gICAgaWYgKHRhZ3MpIHtcbiAgICAgIHRhZ3MuZm9yRWFjaCgodGFnKSA9PiB7XG4gICAgICAgIGNvbnN0IHRhZ1JlZ2V4ID0gbmV3IFJlZ0V4cChgIyR7dGFnLnRhZ31cXFxcYmAsICdnJyk7XG4gICAgICAgIGNsZWFuZWRDb250ZW50ID0gY2xlYW5lZENvbnRlbnQucmVwbGFjZSh0YWdSZWdleCwgJycpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGNsZWFuZWRDb250ZW50LnRyaW0oKTtcbiAgfVxuXG4gIGFzeW5jIHVwZGF0ZURhdGFiYXNlKGZpbGVJbmZvKSB7XG4gICAgY29uc3QgdXBkYXRlTm90ZVNRTCA9IGBcbiAgICAgIElOU0VSVCBPUiBSRVBMQUNFIElOVE8gbm90ZSAocGF0aCwgdGl0bGUsIGNvbnRlbnQsIGNyZWF0ZWQsIGxhc3RfbW9kaWZpZWQsIGxhc3Rfb3BlbmVkKVxuICAgICAgVkFMVUVTIChcbiAgICAgICAgJyR7dGhpcy5lc2NhcGVTUUxTdHJpbmcoZmlsZUluZm8ucGF0aCl9JyxcbiAgICAgICAgJyR7dGhpcy5lc2NhcGVTUUxTdHJpbmcoZmlsZUluZm8udGl0bGUpfScsXG4gICAgICAgICcke3RoaXMuZXNjYXBlU1FMU3RyaW5nKGZpbGVJbmZvLmNvbnRlbnQpfScsXG4gICAgICAgICR7ZmlsZUluZm8uY3JlYXRlZH0sXG4gICAgICAgICR7ZmlsZUluZm8ubGFzdF9tb2RpZmllZH0sXG4gICAgICAgIENPQUxFU0NFKChTRUxFQ1QgbGFzdF9vcGVuZWQgRlJPTSBub3RlIFdIRVJFIHBhdGggPSAnJHt0aGlzLmVzY2FwZVNRTFN0cmluZyhcbiAgICAgICAgICBmaWxlSW5mby5wYXRoXG4gICAgICAgICl9JyksICR7RGF0ZS5ub3coKX0pXG4gICAgICApXG4gICAgYDtcbiAgICBhd2FpdCB0aGlzLmV4ZWN1dGVTUUwodXBkYXRlTm90ZVNRTCk7XG5cbiAgICAvLyBVcGRhdGUgbm90ZV90YWcgcmVsYXRpb25zaGlwc1xuICAgIGF3YWl0IHRoaXMudXBkYXRlTm90ZVRhZ3MoZmlsZUluZm8ucGF0aCwgZmlsZUluZm8udGFncyk7XG5cbiAgICAvLyBVcGRhdGUgbm90ZV9mcm9udG1hdHRlciByZWxhdGlvbnNoaXBzXG4gICAgYXdhaXQgdGhpcy51cGRhdGVOb3RlRnJvbnRtYXR0ZXIoZmlsZUluZm8ucGF0aCwgZmlsZUluZm8uZnJvbnRtYXR0ZXIpO1xuICB9XG5cbiAgYXN5bmMgaW5zZXJ0SW50b0RhdGFiYXNlKGZpbGVJbmZvKSB7XG4gICAgYXdhaXQgdGhpcy51cGRhdGVEYXRhYmFzZShmaWxlSW5mbyk7XG4gIH1cblxuICBhc3luYyBkZWxldGVGcm9tRGF0YWJhc2UocGF0aCkge1xuICAgIGNvbnN0IGRlbGV0ZU5vdGVTUUwgPSBgREVMRVRFIEZST00gbm90ZSBXSEVSRSBwYXRoID0gJyR7dGhpcy5lc2NhcGVTUUxTdHJpbmcoXG4gICAgICBwYXRoXG4gICAgKX0nYDtcbiAgICBhd2FpdCB0aGlzLmV4ZWN1dGVTUUwoZGVsZXRlTm90ZVNRTCk7XG4gICAgLy8gbm90ZV90YWcgYW5kIG5vdGVfZnJvbnRtYXR0ZXIgZW50cmllcyB3aWxsIGJlIGF1dG9tYXRpY2FsbHkgZGVsZXRlZCBkdWUgdG8gT04gREVMRVRFIENBU0NBREVcbiAgfVxuXG4gIGFzeW5jIHVwZGF0ZU5vdGVUYWdzKG5vdGVQYXRoLCB0YWdzKSB7XG4gICAgLy8gUmVtb3ZlIGV4aXN0aW5nIG5vdGVfdGFnIGVudHJpZXMgZm9yIHRoaXMgbm90ZVxuICAgIGNvbnN0IGRlbGV0ZU5vdGVUYWdzU1FMID0gYERFTEVURSBGUk9NIG5vdGVfdGFnIFdIRVJFIG5vdGVfcGF0aCA9ICcke3RoaXMuZXNjYXBlU1FMU3RyaW5nKFxuICAgICAgbm90ZVBhdGhcbiAgICApfSdgO1xuICAgIGF3YWl0IHRoaXMuZXhlY3V0ZVNRTChkZWxldGVOb3RlVGFnc1NRTCk7XG5cbiAgICAvLyBJbnNlcnQgbmV3IG5vdGVfdGFnIGVudHJpZXNcbiAgICBmb3IgKGNvbnN0IHRhZyBvZiB0YWdzKSB7XG4gICAgICBjb25zdCBpbnNlcnRUYWdTUUwgPSBgXG4gICAgICAgIElOU0VSVCBPUiBJR05PUkUgSU5UTyB0YWcgKG5hbWUpIFZBTFVFUyAoJyR7dGhpcy5lc2NhcGVTUUxTdHJpbmcodGFnKX0nKVxuICAgICAgYDtcbiAgICAgIGF3YWl0IHRoaXMuZXhlY3V0ZVNRTChpbnNlcnRUYWdTUUwpO1xuXG4gICAgICBjb25zdCBpbnNlcnROb3RlVGFnU1FMID0gYFxuICAgICAgICBJTlNFUlQgSU5UTyBub3RlX3RhZyAobm90ZV9wYXRoLCB0YWdfbmFtZSkgXG4gICAgICAgIFZBTFVFUyAoJyR7dGhpcy5lc2NhcGVTUUxTdHJpbmcobm90ZVBhdGgpfScsICcke3RoaXMuZXNjYXBlU1FMU3RyaW5nKFxuICAgICAgICB0YWdcbiAgICAgICl9JylcbiAgICAgIGA7XG4gICAgICBhd2FpdCB0aGlzLmV4ZWN1dGVTUUwoaW5zZXJ0Tm90ZVRhZ1NRTCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgdXBkYXRlTm90ZUZyb250bWF0dGVyKG5vdGVQYXRoLCBmcm9udG1hdHRlcikge1xuICAgIC8vIFJlbW92ZSBleGlzdGluZyBub3RlX2Zyb250bWF0dGVyIGVudHJpZXMgZm9yIHRoaXMgbm90ZVxuICAgIGNvbnN0IGRlbGV0ZU5vdGVGcm9udG1hdHRlclNRTCA9IGBERUxFVEUgRlJPTSBub3RlX2Zyb250bWF0dGVyIFdIRVJFIG5vdGVfcGF0aCA9ICcke3RoaXMuZXNjYXBlU1FMU3RyaW5nKFxuICAgICAgbm90ZVBhdGhcbiAgICApfSdgO1xuICAgIGF3YWl0IHRoaXMuZXhlY3V0ZVNRTChkZWxldGVOb3RlRnJvbnRtYXR0ZXJTUUwpO1xuXG4gICAgLy8gSW5zZXJ0IG5ldyBub3RlX2Zyb250bWF0dGVyIGVudHJpZXNcbiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhmcm9udG1hdHRlcikpIHtcbiAgICAgIGNvbnN0IHN0cmluZ2lmaWVkVmFsdWUgPSBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7XG4gICAgICBjb25zdCBpbnNlcnROb3RlRnJvbnRtYXR0ZXJTUUwgPSBgXG4gICAgICAgIElOU0VSVCBJTlRPIG5vdGVfZnJvbnRtYXR0ZXIgKG5vdGVfcGF0aCwgZnJvbnRtYXR0ZXJfbmFtZSwgZnJvbnRtYXR0ZXJfdmFsdWUpIFxuICAgICAgICBWQUxVRVMgKCcke3RoaXMuZXNjYXBlU1FMU3RyaW5nKG5vdGVQYXRoKX0nLCAnJHt0aGlzLmVzY2FwZVNRTFN0cmluZyhcbiAgICAgICAga2V5XG4gICAgICApfScsICcke3RoaXMuZXNjYXBlU1FMU3RyaW5nKHN0cmluZ2lmaWVkVmFsdWUpfScpXG4gICAgICBgO1xuICAgICAgYXdhaXQgdGhpcy5leGVjdXRlU1FMKGluc2VydE5vdGVGcm9udG1hdHRlclNRTCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc3luY1RhZ3MoKSB7XG4gICAgY29uc3QgYWxsVGFncyA9IHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0VGFncygpO1xuXG4gICAgLy8gSW5zZXJ0IGFsbCB0YWdzICh1c2luZyBJTlNFUlQgT1IgSUdOT1JFIHRvIGF2b2lkIGR1cGxpY2F0ZXMpXG4gICAgZm9yIChjb25zdCB0YWcgb2YgT2JqZWN0LmtleXMoYWxsVGFncykpIHtcbiAgICAgIGNvbnN0IGluc2VydFRhZ1NRTCA9IGBcbiAgICAgICAgSU5TRVJUIE9SIElHTk9SRSBJTlRPIHRhZyAobmFtZSkgVkFMVUVTICgnJHt0aGlzLmVzY2FwZVNRTFN0cmluZyhcbiAgICAgICAgICB0YWcuc2xpY2UoMSlcbiAgICAgICAgKX0nKVxuICAgICAgYDtcbiAgICAgIGF3YWl0IHRoaXMuZXhlY3V0ZVNRTChpbnNlcnRUYWdTUUwpO1xuICAgIH1cblxuICAgIC8vIFJlbW92ZSB0YWdzIHRoYXQgYXJlIG5vIGxvbmdlciB1c2VkXG4gICAgY29uc3QgcmVtb3ZlVW51c2VkVGFnc1NRTCA9IGBcbiAgICAgIERFTEVURSBGUk9NIHRhZyBcbiAgICAgIFdIRVJFIG5hbWUgTk9UIElOIChTRUxFQ1QgRElTVElOQ1QgdGFnX25hbWUgRlJPTSBub3RlX3RhZylcbiAgICBgO1xuICAgIGF3YWl0IHRoaXMuZXhlY3V0ZVNRTChyZW1vdmVVbnVzZWRUYWdzU1FMKTtcbiAgfVxuXG4gIGFzeW5jIGZ1bGxTeW5jKCkge1xuICAgIGNvbnNvbGUubG9nKCdQZXJmb3JtaW5nIGZ1bGwgc3luYycpO1xuICAgIGNvbnN0IGZpbGVzID0gdGhpcy5hcHAudmF1bHQuZ2V0TWFya2Rvd25GaWxlcygpO1xuXG4gICAgZm9yIChjb25zdCBmaWxlIG9mIGZpbGVzKSB7XG4gICAgICBjb25zdCBmaWxlSW5mbyA9IGF3YWl0IHRoaXMuZ2V0RmlsZUluZm8oZmlsZSk7XG4gICAgICBhd2FpdCB0aGlzLmluc2VydEludG9EYXRhYmFzZShmaWxlSW5mbyk7XG4gICAgfVxuXG4gICAgYXdhaXQgdGhpcy5zeW5jVGFncygpO1xuXG4gICAgY29uc29sZS5sb2coJ0Z1bGwgc3luYyBjb21wbGV0ZWQnKTtcbiAgfVxuXG4gIGVzY2FwZVNRTFN0cmluZyhzdHIpIHtcbiAgICByZXR1cm4gc3RyLnJlcGxhY2UoLycvZywgXCInJ1wiKTtcbiAgfVxufTtcbiJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7QUFBQSxJQUFNLEVBQUUsUUFBUSxPQUFPLE9BQU8sSUFBSSxRQUFRLFVBQVU7QUFDcEQsSUFBTSxFQUFFLE1BQU0sSUFBSSxRQUFRLGVBQWU7QUFDekMsSUFBTSxPQUFPLFFBQVEsTUFBTTtBQUMzQixJQUFNLEtBQUssUUFBUSxJQUFJO0FBRXZCLE9BQU8sVUFBVSxNQUFNLDJCQUEyQixPQUFPO0FBQUEsRUFDdkQsTUFBTSxTQUFTO0FBQ2IsWUFBUSxJQUFJLG1DQUFtQztBQUUvQyxVQUFNLFlBQVksWUFBWSxJQUFJO0FBRWxDLFFBQUk7QUFDRixZQUFNLEtBQUssbUJBQW1CO0FBRTlCLFdBQUs7QUFBQSxRQUNILEtBQUssSUFBSSxNQUFNLEdBQUcsVUFBVSxLQUFLLGlCQUFpQixLQUFLLElBQUksQ0FBQztBQUFBLE1BQzlEO0FBRUEsV0FBSztBQUFBLFFBQ0gsS0FBSyxJQUFJLE1BQU0sR0FBRyxVQUFVLEtBQUssaUJBQWlCLEtBQUssSUFBSSxDQUFDO0FBQUEsTUFDOUQ7QUFFQSxXQUFLO0FBQUEsUUFDSCxLQUFLLElBQUksTUFBTSxHQUFHLFVBQVUsS0FBSyxpQkFBaUIsS0FBSyxJQUFJLENBQUM7QUFBQSxNQUM5RDtBQUVBLFdBQUs7QUFBQSxRQUNILEtBQUssSUFBSSxNQUFNLEdBQUcsVUFBVSxLQUFLLGlCQUFpQixLQUFLLElBQUksQ0FBQztBQUFBLE1BQzlEO0FBR0EsV0FBSztBQUFBLFFBQ0gsS0FBSyxJQUFJLGNBQWM7QUFBQSxVQUNyQjtBQUFBLFVBQ0EsS0FBSyxxQkFBcUIsS0FBSyxJQUFJO0FBQUEsUUFDckM7QUFBQSxNQUNGO0FBR0EsV0FBSztBQUFBLFFBQ0gsS0FBSyxJQUFJLFVBQVUsR0FBRyxhQUFhLEtBQUssZUFBZSxLQUFLLElBQUksQ0FBQztBQUFBLE1BQ25FO0FBR0EsWUFBTSxLQUFLLFNBQVM7QUFHcEIsV0FBSztBQUFBLFFBQ0gsT0FBTyxZQUFZLE1BQU0sS0FBSyxTQUFTLEdBQUcsS0FBSyxLQUFLLEdBQUk7QUFBQTtBQUFBLE1BQzFEO0FBRUEsWUFBTSxVQUFVLFlBQVksSUFBSTtBQUNoQyxZQUFNLFlBQVksVUFBVTtBQUM1QixZQUFNLGdCQUNKLGFBQWEsTUFDVCxJQUFJLFlBQVksS0FBTSxRQUFRLENBQUMsY0FDL0IsR0FBRyxLQUFLLE1BQU0sU0FBUztBQUU3QixVQUFJLE9BQU8sa0NBQWtDLGVBQWU7QUFBQSxJQUM5RCxTQUFTLE9BQVA7QUFDQSxjQUFRLE1BQU0saUNBQWlDLEtBQUs7QUFDcEQsVUFBSTtBQUFBLFFBQ0Y7QUFBQSxRQUNBO0FBQUEsTUFDRjtBQUFBLElBQ0Y7QUFBQSxFQUNGO0FBQUEsRUFFQSxXQUFXO0FBQ1QsWUFBUSxJQUFJLHFDQUFxQztBQUNqRCxRQUFJLEtBQUssSUFBSTtBQUNYLFdBQUssR0FBRyxNQUFNLElBQUk7QUFBQSxJQUNwQjtBQUFBLEVBQ0Y7QUFBQSxFQUVBLE1BQU0scUJBQXFCO0FBQ3pCLFVBQU0sU0FBUyxLQUFLO0FBQUEsTUFDbEIsSUFBSSxNQUFNLFFBQVE7QUFBQSxNQUNsQjtBQUFBLE1BQ0E7QUFBQSxNQUNBLEtBQUssU0FBUztBQUFBLE1BQ2Q7QUFBQSxJQUNGO0FBR0EsUUFBSSxHQUFHLFdBQVcsTUFBTSxHQUFHO0FBQ3pCLFNBQUcsV0FBVyxNQUFNO0FBQUEsSUFDdEI7QUFHQSxTQUFLLEtBQUssTUFBTSxXQUFXLENBQUMsTUFBTSxDQUFDO0FBQ25DLFNBQUssR0FBRyxPQUFPLEdBQUcsUUFBUSxDQUFDLFNBQVM7QUFDbEMsY0FBUSxJQUFJLG1CQUFtQixNQUFNO0FBQUEsSUFDdkMsQ0FBQztBQUNELFNBQUssR0FBRyxPQUFPLEdBQUcsUUFBUSxDQUFDLFNBQVM7QUFDbEMsY0FBUSxNQUFNLG1CQUFtQixNQUFNO0FBQUEsSUFDekMsQ0FBQztBQUNELFNBQUssR0FBRyxHQUFHLFNBQVMsQ0FBQyxTQUFTO0FBQzVCLGNBQVEsSUFBSSxvQ0FBb0MsTUFBTTtBQUFBLElBQ3hELENBQUM7QUFFRCxVQUFNLGtCQUFrQjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUE4QnhCLFVBQU0sS0FBSyxXQUFXLGVBQWU7QUFBQSxFQUN2QztBQUFBLEVBRUEsV0FBVyxLQUFLO0FBQ2QsV0FBTyxJQUFJLFFBQVEsQ0FBQyxTQUFTLFdBQVc7QUFDdEMsV0FBSyxHQUFHLE1BQU0sTUFBTSxNQUFNLEtBQUs7QUFDL0IsV0FBSyxHQUFHLE1BQU0sTUFBTSwyQkFBMkI7QUFFL0MsVUFBSSxTQUFTO0FBQ2IsWUFBTSxjQUFjLENBQUMsU0FBUztBQUM1QixrQkFBVSxLQUFLLFNBQVM7QUFDeEIsWUFBSSxPQUFPLFNBQVMsZ0JBQWdCLEdBQUc7QUFDckMsZUFBSyxHQUFHLE9BQU8sZUFBZSxRQUFRLFdBQVc7QUFDakQsa0JBQVEsT0FBTyxRQUFRLGtCQUFrQixFQUFFLEVBQUUsS0FBSyxDQUFDO0FBQUEsUUFDckQ7QUFBQSxNQUNGO0FBRUEsV0FBSyxHQUFHLE9BQU8sR0FBRyxRQUFRLFdBQVc7QUFBQSxJQUN2QyxDQUFDO0FBQUEsRUFDSDtBQUFBLEVBRUEsTUFBTSxpQkFBaUIsTUFBTTtBQUMzQixRQUFJLGdCQUFnQixTQUFTLEtBQUssY0FBYyxNQUFNO0FBQ3BELGNBQVEsSUFBSSxrQkFBa0IsS0FBSyxJQUFJO0FBQ3ZDLFlBQU0sV0FBVyxNQUFNLEtBQUssWUFBWSxJQUFJO0FBQzVDLFlBQU0sS0FBSyxlQUFlLFFBQVE7QUFBQSxJQUNwQztBQUFBLEVBQ0Y7QUFBQSxFQUVBLE1BQU0saUJBQWlCLE1BQU07QUFDM0IsUUFBSSxnQkFBZ0IsU0FBUyxLQUFLLGNBQWMsTUFBTTtBQUNwRCxjQUFRLElBQUksaUJBQWlCLEtBQUssSUFBSTtBQUN0QyxZQUFNLFdBQVcsTUFBTSxLQUFLLFlBQVksSUFBSTtBQUM1QyxZQUFNLEtBQUssbUJBQW1CLFFBQVE7QUFBQSxJQUN4QztBQUFBLEVBQ0Y7QUFBQSxFQUVBLE1BQU0saUJBQWlCLE1BQU07QUFDM0IsUUFBSSxnQkFBZ0IsU0FBUyxLQUFLLGNBQWMsTUFBTTtBQUNwRCxjQUFRLElBQUksaUJBQWlCLEtBQUssSUFBSTtBQUN0QyxZQUFNLEtBQUssbUJBQW1CLEtBQUssSUFBSTtBQUFBLElBQ3pDO0FBQUEsRUFDRjtBQUFBLEVBRUEsTUFBTSxpQkFBaUIsTUFBTSxTQUFTO0FBQ3BDLFFBQUksZ0JBQWdCLFNBQVMsS0FBSyxjQUFjLE1BQU07QUFDcEQsY0FBUSxJQUFJLHFCQUFxQixTQUFTLE1BQU0sS0FBSyxJQUFJO0FBQ3pELFlBQU0sS0FBSyxtQkFBbUIsT0FBTztBQUNyQyxZQUFNLFdBQVcsTUFBTSxLQUFLLFlBQVksSUFBSTtBQUM1QyxZQUFNLEtBQUssbUJBQW1CLFFBQVE7QUFBQSxJQUN4QztBQUFBLEVBQ0Y7QUFBQSxFQUVBLE1BQU0scUJBQXFCLE1BQU07QUFDL0IsUUFBSSxnQkFBZ0IsU0FBUyxLQUFLLGNBQWMsTUFBTTtBQUNwRCxjQUFRLElBQUksOEJBQThCLEtBQUssSUFBSTtBQUNuRCxZQUFNLFdBQVcsTUFBTSxLQUFLLFlBQVksSUFBSTtBQUM1QyxZQUFNLEtBQUssZUFBZSxRQUFRO0FBQUEsSUFDcEM7QUFBQSxFQUNGO0FBQUEsRUFFQSxNQUFNLGVBQWUsTUFBTTtBQUN6QixRQUFJLGdCQUFnQixTQUFTLEtBQUssY0FBYyxNQUFNO0FBQ3BELGNBQVEsSUFBSSxnQkFBZ0IsS0FBSyxJQUFJO0FBQ3JDLFlBQU0sc0JBQXNCO0FBQUE7QUFBQSw0QkFFTixLQUFLLElBQUk7QUFBQSx3QkFDYixLQUFLLGdCQUFnQixLQUFLLElBQUk7QUFBQTtBQUVoRCxZQUFNLEtBQUssV0FBVyxtQkFBbUI7QUFBQSxJQUMzQztBQUFBLEVBQ0Y7QUFBQSxFQUVBLE1BQU0sWUFBWSxNQUFNO0FBNU0xQjtBQTZNSSxVQUFNLFFBQVEsS0FBSyxJQUFJLGNBQWMsYUFBYSxJQUFJO0FBQ3RELFVBQU0sZUFBYywrQkFBTyxnQkFBZSxDQUFDO0FBQzNDLFVBQU0sVUFBVSxNQUFNLEtBQUssSUFBSSxNQUFNLEtBQUssSUFBSTtBQUU5QyxVQUFNLGlCQUFpQixLQUFLO0FBQUEsTUFDMUI7QUFBQSxNQUNBO0FBQUEsTUFDQSwrQkFBTztBQUFBLElBQ1Q7QUFFQSxXQUFPO0FBQUEsTUFDTCxNQUFNLEtBQUs7QUFBQSxNQUNYLE9BQU8sWUFBWSxTQUFTLEtBQUs7QUFBQSxNQUNqQyxTQUFTO0FBQUEsTUFDVCxRQUFNLG9DQUFPLFNBQVAsbUJBQWEsSUFBSSxDQUFDLFFBQVEsSUFBSSxTQUFRLENBQUM7QUFBQSxNQUM3QztBQUFBLE1BQ0EsU0FBUyxLQUFLLEtBQUs7QUFBQSxNQUNuQixlQUFlLEtBQUssS0FBSztBQUFBLElBQzNCO0FBQUEsRUFDRjtBQUFBLEVBRUEsc0JBQXNCLFNBQVMsYUFBYSxNQUFNO0FBRWhELFFBQUksaUJBQWlCLFFBQVEsUUFBUSx5QkFBeUIsRUFBRTtBQUdoRSxRQUFJLE1BQU07QUFDUixXQUFLLFFBQVEsQ0FBQyxRQUFRO0FBQ3BCLGNBQU0sV0FBVyxJQUFJLE9BQU8sSUFBSSxJQUFJLFVBQVUsR0FBRztBQUNqRCx5QkFBaUIsZUFBZSxRQUFRLFVBQVUsRUFBRTtBQUFBLE1BQ3RELENBQUM7QUFBQSxJQUNIO0FBRUEsV0FBTyxlQUFlLEtBQUs7QUFBQSxFQUM3QjtBQUFBLEVBRUEsTUFBTSxlQUFlLFVBQVU7QUFDN0IsVUFBTSxnQkFBZ0I7QUFBQTtBQUFBO0FBQUEsV0FHZixLQUFLLGdCQUFnQixTQUFTLElBQUk7QUFBQSxXQUNsQyxLQUFLLGdCQUFnQixTQUFTLEtBQUs7QUFBQSxXQUNuQyxLQUFLLGdCQUFnQixTQUFTLE9BQU87QUFBQSxVQUN0QyxTQUFTO0FBQUEsVUFDVCxTQUFTO0FBQUEsK0RBQzRDLEtBQUs7QUFBQSxNQUMxRCxTQUFTO0FBQUEsSUFDWCxRQUFRLEtBQUssSUFBSTtBQUFBO0FBQUE7QUFHckIsVUFBTSxLQUFLLFdBQVcsYUFBYTtBQUduQyxVQUFNLEtBQUssZUFBZSxTQUFTLE1BQU0sU0FBUyxJQUFJO0FBR3RELFVBQU0sS0FBSyxzQkFBc0IsU0FBUyxNQUFNLFNBQVMsV0FBVztBQUFBLEVBQ3RFO0FBQUEsRUFFQSxNQUFNLG1CQUFtQixVQUFVO0FBQ2pDLFVBQU0sS0FBSyxlQUFlLFFBQVE7QUFBQSxFQUNwQztBQUFBLEVBRUEsTUFBTSxtQkFBbUJBLE9BQU07QUFDN0IsVUFBTSxnQkFBZ0Isa0NBQWtDLEtBQUs7QUFBQSxNQUMzREE7QUFBQSxJQUNGO0FBQ0EsVUFBTSxLQUFLLFdBQVcsYUFBYTtBQUFBLEVBRXJDO0FBQUEsRUFFQSxNQUFNLGVBQWUsVUFBVSxNQUFNO0FBRW5DLFVBQU0sb0JBQW9CLDJDQUEyQyxLQUFLO0FBQUEsTUFDeEU7QUFBQSxJQUNGO0FBQ0EsVUFBTSxLQUFLLFdBQVcsaUJBQWlCO0FBR3ZDLGVBQVcsT0FBTyxNQUFNO0FBQ3RCLFlBQU0sZUFBZTtBQUFBLG9EQUN5QixLQUFLLGdCQUFnQixHQUFHO0FBQUE7QUFFdEUsWUFBTSxLQUFLLFdBQVcsWUFBWTtBQUVsQyxZQUFNLG1CQUFtQjtBQUFBO0FBQUEsbUJBRVosS0FBSyxnQkFBZ0IsUUFBUSxRQUFRLEtBQUs7QUFBQSxRQUNyRDtBQUFBLE1BQ0Y7QUFBQTtBQUVBLFlBQU0sS0FBSyxXQUFXLGdCQUFnQjtBQUFBLElBQ3hDO0FBQUEsRUFDRjtBQUFBLEVBRUEsTUFBTSxzQkFBc0IsVUFBVSxhQUFhO0FBRWpELFVBQU0sMkJBQTJCLG1EQUFtRCxLQUFLO0FBQUEsTUFDdkY7QUFBQSxJQUNGO0FBQ0EsVUFBTSxLQUFLLFdBQVcsd0JBQXdCO0FBRzlDLGVBQVcsQ0FBQyxLQUFLLEtBQUssS0FBSyxPQUFPLFFBQVEsV0FBVyxHQUFHO0FBQ3RELFlBQU0sbUJBQW1CLEtBQUssVUFBVSxLQUFLO0FBQzdDLFlBQU0sMkJBQTJCO0FBQUE7QUFBQSxtQkFFcEIsS0FBSyxnQkFBZ0IsUUFBUSxRQUFRLEtBQUs7QUFBQSxRQUNyRDtBQUFBLE1BQ0YsUUFBUSxLQUFLLGdCQUFnQixnQkFBZ0I7QUFBQTtBQUU3QyxZQUFNLEtBQUssV0FBVyx3QkFBd0I7QUFBQSxJQUNoRDtBQUFBLEVBQ0Y7QUFBQSxFQUVBLE1BQU0sV0FBVztBQUNmLFVBQU0sVUFBVSxLQUFLLElBQUksY0FBYyxRQUFRO0FBRy9DLGVBQVcsT0FBTyxPQUFPLEtBQUssT0FBTyxHQUFHO0FBQ3RDLFlBQU0sZUFBZTtBQUFBLG9EQUN5QixLQUFLO0FBQUEsUUFDL0MsSUFBSSxNQUFNLENBQUM7QUFBQSxNQUNiO0FBQUE7QUFFRixZQUFNLEtBQUssV0FBVyxZQUFZO0FBQUEsSUFDcEM7QUFHQSxVQUFNLHNCQUFzQjtBQUFBO0FBQUE7QUFBQTtBQUk1QixVQUFNLEtBQUssV0FBVyxtQkFBbUI7QUFBQSxFQUMzQztBQUFBLEVBRUEsTUFBTSxXQUFXO0FBQ2YsWUFBUSxJQUFJLHNCQUFzQjtBQUNsQyxVQUFNLFFBQVEsS0FBSyxJQUFJLE1BQU0saUJBQWlCO0FBRTlDLGVBQVcsUUFBUSxPQUFPO0FBQ3hCLFlBQU0sV0FBVyxNQUFNLEtBQUssWUFBWSxJQUFJO0FBQzVDLFlBQU0sS0FBSyxtQkFBbUIsUUFBUTtBQUFBLElBQ3hDO0FBRUEsVUFBTSxLQUFLLFNBQVM7QUFFcEIsWUFBUSxJQUFJLHFCQUFxQjtBQUFBLEVBQ25DO0FBQUEsRUFFQSxnQkFBZ0IsS0FBSztBQUNuQixXQUFPLElBQUksUUFBUSxNQUFNLElBQUk7QUFBQSxFQUMvQjtBQUNGOyIsCiAgIm5hbWVzIjogWyJwYXRoIl0KfQo=
